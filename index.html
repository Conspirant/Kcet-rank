<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCET 2025 Rank Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;700&display=swap');
        :root {
            --primary: #6495ed;
            --secondary: #c71585;
            --primary-light: rgba(100, 149, 237, 0.3);
            --secondary-light: rgba(199, 21, 133, 0.3);
            --gradient-angle: 135deg;
        }
        [data-theme="purple"] {
            --primary: #7b2cbf;
            --secondary: #00b7eb;
            --primary-light: rgba(123, 44, 191, 0.3);
            --secondary-light: rgba(0, 183, 235, 0.3);
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(var(--gradient-angle), #0a0a2b, #1e1e5c, #2a1a8c);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden;
            position: relative;
            animation: hueShift 20s infinite linear;
        }
        @keyframes hueShift {
            0%, 100% { --gradient-angle: 135deg; }
            50% { --gradient-angle: 145deg; }
        }
        h1, h2, h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            position: relative;
        }
        h1::after, h2::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            top: -4px;
            right: -4px;
            box-shadow: 0 0 8px var(--primary);
            animation: sparkle 2s infinite ease-in-out;
        }
        @keyframes sparkle {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }
        .card {
            background: rgba(20, 20, 50, 0.85);
            border: 2px solid var(--primary-light);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4), inset 0 0 12px var(--primary-light);
            backdrop-filter: blur(15px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            will-change: transform;
        }
        .card:hover {
            transform: translateY(-6px) rotateX(2deg) rotateY(2deg);
            box-shadow: 0 10px 36px rgba(0, 0, 0, 0.5), inset 0 0 14px var(--primary-light);
        }
        .error {
            color: #ff6b6b;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            text-shadow: 0 0 4px rgba(255, 107, 107, 0.5);
        }
        .shake {
            animation: shake 0.3s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        .progress-bar {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 0.75rem;
            border-radius: 9999px;
            transition: width 0.6s ease-in-out;
            box-shadow: 0 0 10px var(--primary);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            transition: all 0.3s ease;
            touch-action: manipulation;
            min-width: 120px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 2px solid var(--primary-light);
            box-shadow: 0 4px 12px var(--primary-light), inset 0 0 8px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            will-change: transform, box-shadow;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }
        .btn:active::before {
            width: 200px;
            height: 200px;
        }
        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px var(--primary-light);
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 8px var(--primary-light), inset 0 0 6px var(--primary-light); }
            50% { box-shadow: 0 0 16px var(--primary), inset 0 0 10px var(--primary); }
            100% { box-shadow: 0 0 8px var(--primary-light), inset 0 0 6px var(--primary-light); }
        }
        .btn-pulse {
            animation: pulse 2s infinite ease-in-out;
        }
        .disclaimer {
            background: rgba(255, 215, 0, 0.15);
            border-left: 4px solid #ffd700;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.75rem;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2);
        }
        .modal {
            background: rgba(10, 10, 40, 0.95);
            backdrop-filter: blur(18px);
            animation: modalFadeIn 0.5s ease-out;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .tips-widget {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 50;
        }
        .cutoff-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(20, 20, 50, 0.9);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), inset 0 0 10px var(--primary-light);
            position: relative;
        }
        .cutoff-table::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid var(--primary);
            border-radius: 12px;
            opacity: 0.3;
            pointer-events: none;
            animation: neon 3s infinite ease-in-out;
        }
        @keyframes neon {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        .cutoff-table th, .cutoff-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--primary-light);
        }
        .cutoff-table th {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            color: #fff;
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.5);
        }
        .cutoff-table tr {
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        .cutoff-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }
        .cutoff-table tr:hover {
            background: var(--primary-light);
            box-shadow: inset 0 0 10px var(--primary-light);
        }
        input, select {
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            border: 1px solid var(--primary-light);
            background: rgba(20, 20, 50, 0.9);
        }
        input:focus, select:focus {
            box-shadow: 0 0 14px var(--primary);
            border-color: var(--primary);
        }
        .glow-text {
            text-shadow: 0 0 14px var(--primary), 0 0 18px var(--secondary);
        }
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 12px var(--primary-light);
        }
        .particle:nth-child(odd) {
            width: 4px;
            height: 4px;
            background: var(--secondary);
        }
        .particle:nth-child(3n) {
            width: 3px;
            height: 3px;
            opacity: 0.6;
        }
        @keyframes float {
            0% { transform: translateY(100vh) scale(1); opacity: 0.8; }
            100% { transform: translateY(-100vh) scale(0.3); opacity: 0; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-fade-in {
            animation: fadeIn 0.7s ease-out forwards;
        }
        @media (max-width: 640px) {
            body { padding: 0.5rem; }
            .card { padding: 1rem; border-radius: 16px; transform: none !important; }
            h1 { font-size: 1.75rem; }
            h2 { font-size: 1.25rem; }
            h3 { font-size: 1rem; }
            .btn { padding: 0.5rem 1rem; font-size: 0.75rem; min-width: 100px; }
            .modal { padding: 0.5rem; }
            .modal .card { max-width: 90vw; transform: none !important; }
            .grid-cols-2 { grid-template-columns: 1fr; }
            select, input { font-size: 0.875rem; }
            .cutoff-table th, .cutoff-table td { padding: 0.5rem; font-size: 0.7rem; }
            .particle, .btn-pulse, h1::after, h2::after { display: none; animation: none; }
        }
        @media (min-width: 641px) {
            body { padding: 1.5rem; }
            h1 { font-size: 2.5rem; }
            h2 { font-size: 1.75rem; }
            h3 { font-size: 1.25rem; }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-6 animate-fade-in">
            <div class="flex justify-end mb-2">
                <button id="themeToggle" class="btn btn-pulse text-white text-xs px-3 py-1">Switch Theme</button>
            </div>
            <h1 class="text-3xl sm:text-4xl font-bold text-white glow-text">KCET 2025 Rank Predictor</h1>
            <p class="text-sm sm:text-base text-gray-300 mt-2">Chart Your Path to Excellence</p>
        </header>

        <div class="disclaimer mb-6 animate-fade-in">
            <p><strong>Disclaimer:</strong> This tool uses sample data for predictions. Actual results may vary. Verify with official KEA sources.</p>
            <p id="apiWarning" class="hidden text-yellow-300 mt-2">Using static data due to API unavailability.</p>
        </div>

        <div class="card mb-6 animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-semibold mb-4 text-center glow-text">Input Your Total Marks</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                <div>
                    <h3 class="text-base sm:text-lg font-medium mb-3">PUC Total (Out of 300)</h3>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium">Total Marks</label>
                        <input type="number" id="pucTotalInput" value="180" min="0" max="300" class="w-full p-2 rounded text-sm sm:text-base">
                        <div id="pucTotalError" class="error hidden"></div>
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>PUC Percentage</span>
                            <span id="pucPercent">60%</span>
                        </div>
                        <div class="w-full bg-gray-800 h-3 rounded-full mt-1">
                            <div id="pucProgress" class="progress-bar" style="width: 60%"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-base sm:text-lg font-medium mb-3">KCET Total (Out of 180)</h3>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium">Total Marks</label>
                        <input type="number" id="kcetTotalInput" value="120" min="0" max="180" class="w-full p-2 rounded text-sm sm:text-base">
                        <div id="kcetTotalError" class="error hidden"></div>
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>KCET Percentage</span>
                            <span id="kcetPercent">66.67%</span>
                        </div>
                        <div class="w-full bg-gray-800 h-3 rounded-full mt-1">
                            <div id="kcetProgress" class="progress-bar" style="width: 66.67%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-xs sm:text-sm font-medium mb-2">Category</label>
                <select id="category" class="w-full p-2 rounded text-sm sm:text-base">
                    <option value="GM">General Merit</option>
                    <option value="OBC">OBC</option>
                    <option value="SC">SC</option>
                    <option value="ST">ST</option>
                </select>
            </div>
            <div class="mt-4">
                <label class="block text-xs sm:text-sm font-medium mb-2">Previous KCET Rank (Optional)</label>
                <input type="number" id="prevRank" min="0" max="1000000" placeholder="Enter past rank" class="w-full p-2 rounded text-sm sm:text-base">
            </div>
            <div class="mt-4 text-center">
                <h3 class="text-base sm:text-lg font-medium">Live Rank Preview</h3>
                <p id="liveRank" class="text-xl sm:text-2xl font-bold text-white glow-text">--</p>
            </div>
            <div class="mt-4 flex flex-wrap justify-center gap-3">
                <button id="calculate" class="btn btn-pulse text-white">Calculate Rank</button>
                <button id="save" class="btn btn-pulse text-white">Save Inputs</button>
                <button id="collegeMatch" class="btn btn-pulse text-white">Find Colleges</button>
                <button id="branchPredict" class="btn btn-pulse text-white">Predict Branches</button>
                <button id="studyPlan" class="btn btn-pulse text-white">Study Plan</button>
                <button id="analytics" class="btn btn-pulse text-white">Analytics</button>
                <button id="reset" class="btn btn-pulse text-white">Reset</button>
            </div>
        </div>

        <div id="result" class="card mb-6 hidden animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-semibold mb-4 text-center glow-text">Your Predicted Rank</h2>
            <div class="text-center mb-4">
                <p id="finalRank" class="text-3xl sm:text-4xl font-bold text-white glow-text">--</p>
                <p class="text-xs sm:text-sm text-gray-300">Rank Range: <span id="rankRange">-- to --</span></p>
                <p class="text-xs sm:text-sm text-gray-300">Category: <span id="categoryDisplay">GM</span></p>
                <p id="rankComparison" class="text-xs sm:text-sm text-gray-300 hidden"></p>
            </div>
            <div class="mb-4">
                <h3 class="text-base sm:text-lg font-medium mb-2">Calculation Steps</h3>
                <div class="bg-gray-900 p-3 rounded text-xs sm:text-sm">
                    <p class="mb-2"><strong>PUC %:</strong> <span id="stepPuc">--</span></p>
                    <p class="mb-2"><strong>KCET %:</strong> <span id="stepKcet">--</span></p>
                    <p><strong>Composite Score:</strong> <span id="stepComposite">--</span></p>
                </div>
            </div>
            <div class="mb-4">
                <h3 class="text-base sm:text-lg font-medium mb-2">Historical Cutoff Ranks (2022–2024)</h3>
                <div class="flex flex-col sm:flex-row gap-2 mb-2">
                    <select id="trendCollege" class="w-full sm:w-1/3 p-2 rounded text-xs sm:text-sm">
                        <option value="RV College of Engineering">RV College of Engineering</option>
                        <option value="PES University">PES University</option>
                    </select>
                    <select id="trendBranch" class="w-full sm:w-1/3 p-2 rounded text-xs sm:text-sm"></select>
                </div>
                <table id="cutoffTable" class="cutoff-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Cutoff Rank</th>
                        </tr>
                    </thead>
                    <tbody id="cutoffTableBody"></tbody>
                </table>
            </div>
            <div class="flex flex-wrap justify-center gap-3">
                <button id="edit" class="btn btn-pulse text-white">Edit Marks</button>
                <button id="viewColleges" class="btn btn-pulse text-white">View Colleges</button>
                <button id="downloadPdf" class="btn btn-pulse text-white">Download PDF</button>
            </div>
        </div>

        <div id="colleges" class="card mb-6 hidden animate-fade-in">
            <h2 class="text-xl sm:text-2xl font-semibold mb-4 text-center glow-text">College Suggestions</h2>
            <div id="collegeList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
            <div class="mt-4 flex justify-center">
                <button id="backToResult" class="btn btn-pulse text-white">Back to Result</button>
            </div>
        </div>

        <div id="modal" class="fixed inset-0 modal flex items-center justify-center hidden z-50 p-2 sm:p-4">
            <div class="card max-w-md w-full p-4 sm:p-6">
                <div class="flex justify-between mb-3">
                    <h2 id="modalTitle" class="text-lg sm:text-xl font-semibold glow-text"></h2>
                    <button id="closeModal" class="text-gray-300 hover:text-white text-lg">✕</button>
                </div>
                <div id="modalContent" class="text-gray-200 text-xs sm:text-sm"></div>
                <div id="modalActions" class="mt-3 flex justify-end gap-2 sm:gap-4"></div>
            </div>
        </div>

        <div class="tips-widget">
            <button id="tipsBtn" class="btn bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-full p-2 sm:p-3 text-sm btn-pulse">Tips</button>
            <div id="tipsContent" class="hidden card p-3 w-56 sm:w-64 mt-2 text-xs sm:text-sm">
                <p id="tipText"></p>
            </div>
        </div>

    <script>
        console.log('Initializing KCET Rank Predictor...');

        let colleges = [
            {
                name: "RV College of Engineering",
                branches: [
                    { 
                        name: "Computer Science", 
                        cutoff: { GM: 1000, OBC: 1500, SC: 5000, ST: 6000 }, 
                        trends: { 2022: 1200, 2023: 1100, 2024: 1000 },
                        demand: "High", 
                        placement: "95%" 
                    },
                    { 
                        name: "Electronics", 
                        cutoff: { GM: 3000, OBC: 4000, SC: 8000, ST: 9000 }, 
                        trends: { 2022: 3500, 2023: 3200, 2024: 3000 },
                        demand: "Medium", 
                        placement: "85%" 
                    }
                ],
                location: "Bangalore"
            },
            {
                name: "PES University",
                branches: [
                    { 
                        name: "Computer Science", 
                        cutoff: { GM: 800, OBC: 1200, SC: 4000, ST: 4500 }, 
                        trends: { 2022: 900, 2023: 850, 2024: 800 },
                        demand: "High", 
                        placement: "92%" 
                    },
                    { 
                        name: "Mechanical", 
                        cutoff: { GM: 5000, OBC: 6000, SC: 10000, ST: 11000 }, 
                        trends: { 2022: 5500, 2023: 5200, 2024: 5000 },
                        demand: "Low", 
                        placement: "75%" 
                    }
                ],
                location: "Bangalore"
            }
        ];

        const rankTable = [
            { score: 100, rank: 100 }, { score: 99, rank: 150 }, { score: 98, rank: 200 }, { score: 97, rank: 300 },
            { score: 96, rank: 400 }, { score: 95, rank: 500 }, { score: 94, rank: 600 }, { score: 93, rank: 750 },
            { score: 92, rank: 900 }, { score: 91, rank: 1100 }, { score: 90, rank: 1300 }, { score: 89, rank: 1500 },
            { score: 88, rank: 1800 }, { score: 87, rank: 2100 }, { score: 86, rank: 2500 }, { score: 85, rank: 3000 },
            { score: 84, rank: 3500 }, { score: 83, rank: 4000 }, { score: 82, rank: 4500 }, { score: 81, rank: 5000 },
            { score: 80, rank: 5500 }, { score: 79, rank: 6000 }, { score: 78, rank: 6500 }, { score: 77, rank: 7000 },
            { score: 76, rank: 8000 }, { score: 75, rank: 9000 }, { score: 74, rank: 10000 }, { score: 73, rank: 11000 },
            { score: 72, rank: 12000 }, { score: 71, rank: 13000 }, { score: 70, rank: 14000 }, { score: 69, rank: 15000 },
            { score: 68, rank: 16000 }, { score: 67, rank: 18000 }, { score: 66, rank: 20000 }, { score: 65, rank: 22000 },
            { score: 64, rank: 24000 }, { score: 63, rank: 26000 }, { score: 62, rank: 28000 }, { score: 61, rank: 30000 },
            { score: 60, rank: 32000 }, { score: 59, rank: 35000 }, { score: 58, rank: 38000 }, { score: 57, rank: 41000 },
            { score: 56, rank: 44000 }, { score: 55, rank: 47000 }, { score: 54, rank: 50000 }, { score: 53, rank: 53000 },
            { score: 52, rank: 56000 }, { score: 51, rank: 59000 }, { score: 50, rank: 62000 }, { score: 49, rank: 65000 },
            { score: 48, rank: 68000 }, { score: 47, rank: 71000 }, { score: 46, rank: 74000 }, { score: 45, rank: 77000 },
            { score: 44, rank: 80000 }, { score: 43, rank: 83000 }, { score: 42, rank: 86000 }, { score: 41, rank: 89000 },
            { score: 40, rank: 92000 }, { score: 39, rank: 95000 }, { score: 38, rank: 98000 }, { score: 37, rank: 101000 },
            { score: 36, rank: 104000 }, { score: 35, rank: 107000 }, { score: 34, rank: 110000 }, { score: 33, rank: 115000 },
            { score: 32, rank: 120000 }, { score: 31, rank: 125000 }, { score: 30, rank: 130000 }, { score: 29, rank: 135000 },
            { score: 28, rank: 140000 }, { score: 27, rank: 145000 }, { score: 26, rank: 150000 }, { score: 25, rank: 155000 },
            { score: 24, rank: 160000 }, { score: 23, rank: 165000 }, { score: 22, rank: 170000 }, { score: 20, rank: 175000 }
        ];

        const tips = [
            'Practice 10 MCQs daily per subject.',
            'Revise weak topics for 1 hour daily.',
            'Take weekly mock tests.',
            'Focus on time management.',
            'Review Organic Chemistry reactions.'
        ];

        let currentRank = 0;
        let predictions = JSON.parse(localStorage.getItem('kcetPredictions')) || [];

        const els = {
            inputs: {
                pucTotal: document.getElementById('pucTotalInput'),
                kcetTotal: document.getElementById('kcetTotalInput'),
                category: document.getElementById('category'),
                prevRank: document.getElementById('prevRank')
            },
            errors: {
                pucTotal: document.getElementById('pucTotalError'),
                kcetTotal: document.getElementById('kcetTotalError')
            },
            totals: {
                pucPercent: document.getElementById('pucPercent'),
                pucProgress: document.getElementById('pucProgress'),
                kcetPercent: document.getElementById('kcetPercent'),
                kcetProgress: document.getElementById('kcetProgress')
            },
            liveRank: document.getElementById('liveRank'),
            result: document.getElementById('result'),
            finalRank: document.getElementById('finalRank'),
            rankRange: document.getElementById('rankRange'),
            categoryDisplay: document.getElementById('categoryDisplay'),
            rankComparison: document.getElementById('rankComparison'),
            stepPuc: document.getElementById('stepPuc'),
            stepKcet: document.getElementById('stepKcet'),
            stepComposite: document.getElementById('stepComposite'),
            trendCollege: document.getElementById('trendCollege'),
            trendBranch: document.getElementById('trendBranch'),
            cutoffTableBody: document.getElementById('cutoffTableBody'),
            colleges: document.getElementById('colleges'),
            collegeList: document.getElementById('collegeList'),
            calculate: document.getElementById('calculate'),
            save: document.getElementById('save'),
            collegeMatch: document.getElementById('collegeMatch'),
            branchPredict: document.getElementById('branchPredict'),
            studyPlan: document.getElementById('studyPlan'),
            analytics: document.getElementById('analytics'),
            reset: document.getElementById('reset'),
            edit: document.getElementById('edit'),
            viewColleges: document.getElementById('viewColleges'),
            downloadPdf: document.getElementById('downloadPdf'),
            backToResult: document.getElementById('backToResult'),
            modal: document.getElementById('modal'),
            modalTitle: document.getElementById('modalTitle'),
            modalContent: document.getElementById('modalContent'),
            modalActions: document.getElementById('modalActions'),
            closeModal: document.getElementById('closeModal'),
            themeToggle: document.getElementById('themeToggle'),
            apiWarning: document.getElementById('apiWarning'),
            tipsBtn: document.getElementById('tipsBtn'),
            tipsContent: document.getElementById('tipsContent'),
            tipText: document.getElementById('tipText')
        };

        function init() {
            console.log('Setting up...');
            if (!els.calculate) console.error('Calculate button not found');
            loadSavedInputs();
            fetchCutoffs();
            setupInputs();
            setupButtons();
            setupTipsWidget();
            setupTheme();
            setupParticles();
            updateTotals();
            updateLiveRank();
            updateTrendCollegeOptions();
        }

        function loadSavedInputs() {
            const saved = localStorage.getItem('kcetInputs');
            if (saved) {
                const data = JSON.parse(saved);
                els.inputs.pucTotal.value = data.pucTotal || '';
                els.inputs.kcetTotal.value = data.kcetTotal || '';
                els.inputs.category.value = data.category || 'GM';
                updateTotals();
                updateLiveRank();
            }
        }

        async function fetchCutoffs() {
            console.log('Fetching cutoffs...');
            try {
                // Mock API (replace with real endpoint if available)
                const response = await fetch('https://api.example.com/kcet-cutoffs', { method: 'GET' });
                if (!response.ok) throw new Error('API fetch failed');
                colleges = await response.json();
                els.apiWarning.classList.add('hidden');
                console.log('Cutoffs fetched:', colleges);
            } catch (err) {
                console.warn('API error, using static data:', err);
                els.apiWarning.classList.remove('hidden');
            }
            updateTrendCollegeOptions();
        }

        function setupParticles() {
            const container = document.getElementById('particles');
            const particles = 12;
            for (let i = 0; i < particles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animation = `float ${10 + Math.random() * 4}s infinite linear`;
                particle.style.animationDelay = `${Math.random() * 10}s`;
                container.appendChild(particle);
            }
            let isScrolling;
            window.addEventListener('scroll', () => {
                clearTimeout(isScrolling);
                container.style.display = 'none';
                isScrolling = setTimeout(() => {
                    container.style.display = 'block';
                }, 150);
            });
        }

        function setupInputs() {
            const inputConfigs = [
                { el: els.inputs.pucTotal, error: els.errors.pucTotal, max: 300 },
                { el: els.inputs.kcetTotal, error: els.errors.kcetTotal, max: 180 }
            ];
            inputConfigs.forEach(({ el, error, max }) => {
                if (!el || !error) {
                    console.error(`Input or error element missing for max ${max}`);
                    return;
                }
                el.addEventListener('input', () => {
                    const value = parseFloat(el.value) || 0;
                    if (value < 0 || value > max || isNaN(value)) {
                        error.textContent = `Enter 0–${max}`;
                        error.classList.remove('hidden');
                        el.classList.add('shake');
                        setTimeout(() => el.classList.remove('shake'), 300);
                    } else {
                        error.classList.add('hidden');
                        el.value = value;
                    }
                    updateTotals();
                    updateLiveRank();
                });
            });
            els.inputs.prevRank.addEventListener('input', () => {
                const value = parseFloat(els.inputs.prevRank.value) || 0;
                if (value < 0 || value > 1000000) {
                    els.inputs.prevRank.classList.add('shake');
                    setTimeout(() => els.inputs.prevRank.classList.remove('shake'), 300);
                }
            });
        }

        function updateTotals() {
            const pucTotal = parseFloat(els.inputs.pucTotal.value) || 0;
            const pucPercent = (pucTotal / 300) * 100;
            els.totals.pucPercent.textContent = pucPercent.toFixed(2) + '%';
            els.totals.pucProgress.style.width = pucPercent.toFixed(2) + '%';
            const kcetTotal = parseFloat(els.inputs.kcetTotal.value) || 0;
            const kcetPercent = (kcetTotal / 180) * 100;
            els.totals.kcetPercent.textContent = kcetPercent.toFixed(2) + '%';
            els.totals.kcetProgress.style.width = kcetPercent.toFixed(2) + '%';
        }

        function calculateCompositeScore(pucTotal, kcetTotal) {
            console.log('Calculating composite score:', { pucTotal, kcetTotal });
            const pucPercent = (parseFloat(pucTotal) || 0) / 300 * 100;
            const kcetPercent = (parseFloat(kcetTotal) || 0) / 180 * 100;
            const normalization = 1 - 0.1 * Math.abs(pucPercent - kcetPercent) / 100;
            const composite = ((pucPercent * 0.4) + (kcetPercent * 0.6)) * normalization;
            console.log('Composite score result:', { pucPercent, kcetPercent, normalization, composite });
            return { puc: pucPercent, kcet: kcetPercent, composite, normalization };
        }

        function getCategoryModifier(score, category) {
            const baseModifiers = { GM: 1, OBC: 0.92, SC: 0.75, ST: 0.7 };
            const scoreFactor = score < 60 ? 0.85 : score < 80 ? 0.9 : 0.95;
            const modifier = baseModifiers[category] * scoreFactor;
            console.log('Category modifier:', { score, category, modifier });
            return modifier;
        }

        function estimateRank(score, category) {
            console.log('Estimating rank:', { score, category });
            if (isNaN(score) || score < 0) return 175000;
            if (score >= rankTable[0].score) return Math.round(rankTable[0].rank * getCategoryModifier(score, category));
            if (score <= rankTable[rankTable.length - 1].score) return Math.round(rankTable[rankTable.length - 1].rank * getCategoryModifier(score, category));
            for (let i = 0; i < rankTable.length - 1; i++) {
                const high = rankTable[i];
                const low = rankTable[i + 1];
                if (score <= high.score && score > low.score) {
                    const fraction = (high.score - score) / (high.score - low.score);
                    const baseRank = high.rank + fraction * (low.rank - high.rank);
                    const logisticFactor = 1 / (1 + Math.exp(-0.12 * (score - 70)));
                    const adjustedRank = baseRank * (1 - 0.25 * logisticFactor);
                    const finalRank = Math.round(adjustedRank * getCategoryModifier(score, category));
                    console.log('Rank calculated:', { baseRank, logisticFactor, adjustedRank, finalRank });
                    return finalRank;
                }
            }
            return 175000;
        }

        function updateLiveRank() {
            console.log('Updating live rank');
            const { composite } = calculateCompositeScore(
                els.inputs.pucTotal.value,
                els.inputs.kcetTotal.value
            );
            els.liveRank.textContent = estimateRank(composite, els.inputs.category.value).toLocaleString();
        }

        function calculateRank() {
            console.log('Calculate Rank button clicked');
            try {
                // Validate inputs
                const pucTotal = parseFloat(els.inputs.pucTotal.value) || 0;
                const kcetTotal = parseFloat(els.inputs.kcetTotal.value) || 0;
                const category = els.inputs.category.value;
                console.log('Inputs:', { pucTotal, kcetTotal, category });

                if (pucTotal < 0 || pucTotal > 300 || isNaN(pucTotal)) {
                    els.errors.pucTotal.textContent = 'Enter 0–300';
                    els.errors.pucTotal.classList.remove('hidden');
                    throw new Error('Invalid PUC total');
                }
                if (kcetTotal < 0 || kcetTotal > 180 || isNaN(kcetTotal)) {
                    els.errors.kcetTotal.textContent = 'Enter 0–180';
                    els.errors.kcetTotal.classList.remove('hidden');
                    throw new Error('Invalid KCET total');
                }
                if (!['GM', 'OBC', 'SC', 'ST'].includes(category)) {
                    throw new Error('Invalid category');
                }

                // Clear errors
                els.errors.pucTotal.classList.add('hidden');
                els.errors.kcetTotal.classList.add('hidden');

                // Calculate scores
                const scores = calculateCompositeScore(pucTotal, kcetTotal);
                currentRank = estimateRank(scores.composite, category);
                console.log('Final rank:', currentRank);

                // Update DOM
                if (!els.finalRank || !els.rankRange || !els.categoryDisplay) {
                    throw new Error('Result elements missing');
                }
                els.finalRank.textContent = currentRank.toLocaleString();
                els.rankRange.textContent = `${Math.round(currentRank * 0.97)} to ${Math.round(currentRank * 1.03)}`;
                els.categoryDisplay.textContent = category;
                els.stepPuc.textContent = `${pucTotal} / 300 * 100 = ${scores.puc.toFixed(2)}%`;
                els.stepKcet.textContent = `${kcetTotal} / 180 * 100 = ${scores.kcet.toFixed(2)}%`;
                els.stepComposite.textContent = `(${scores.puc.toFixed(2)} * 0.4) + (${scores.kcet.toFixed(2)} * 0.6) * ${scores.normalization.toFixed(2)} = ${scores.composite.toFixed(2)}%`;

                // Handle previous rank comparison
                const prevRank = parseFloat(els.inputs.prevRank.value) || 0;
                if (prevRank > 0) {
                    const diff = prevRank - currentRank;
                    els.rankComparison.textContent = `Compared to previous rank (${prevRank.toLocaleString()}): ${diff > 0 ? 'Improved by' : 'Declined by'} ${Math.abs(diff).toLocaleString()} ranks`;
                    els.rankComparison.classList.remove('hidden');
                } else {
                    els.rankComparison.classList.add('hidden');
                }

                // Save prediction
                predictions.push({
                    timestamp: new Date().toISOString(),
                    pucPercent: scores.puc,
                    kcetPercent: scores.kcet,
                    category,
                    rank: currentRank
                });
                localStorage.setItem('kcetPredictions', JSON.stringify(predictions));

                // Update cutoff table and show result
                updateCutoffTable();
                if (els.result) {
                    els.result.classList.remove('hidden');
                    els.colleges.classList.add('hidden');
                } else {
                    throw new Error('Result container missing');
                }
            } catch (err) {
                console.error('Calculate Rank error:', err);
                alert('Error calculating rank: ' + err.message);
            }
        }

        function updateCutoffTable() {
            try {
                const collegeName = els.trendCollege.value;
                const branchName = els.trendBranch.value;
                const college = colleges.find(c => c.name === collegeName);
                const branch = college.branches.find(b => b.name === branchName);
                els.cutoffTableBody.innerHTML = `
                    <tr><td>2022</td><td>${branch.trends[2022].toLocaleString()}</td></tr>
                    <tr><td>2023</td><td>${branch.trends[2023].toLocaleString()}</td></tr>
                    <tr><td>2024</td><td>${branch.trends[2024].toLocaleString()}</td></tr>
                `;
            } catch (err) {
                console.error('Cutoff table error:', err);
            }
        }

        function updateTrendCollegeOptions() {
            els.trendCollege.innerHTML = colleges.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
            updateTrendBranchOptions();
        }

        function updateTrendBranchOptions() {
            const collegeName = els.trendCollege.value;
            const college = colleges.find(c => c.name === collegeName);
            els.trendBranch.innerHTML = college.branches.map(b => `<option value="${b.name}">${b.name}</option>`).join('');
            updateCutoffTable();
        }

        function setupTipsWidget() {
            let tipIndex = 0;
            function showTip() {
                els.tipText.textContent = tips[tipIndex];
                tipIndex = (tipIndex + 1) % tips.length;
            }
            showTip();
            setInterval(showTip, 10000);
            els.tipsBtn.addEventListener('click', () => {
                console.log('Tips button clicked');
                els.tipsContent.classList.toggle('hidden');
                if (!els.tipsContent.classList.contains('hidden')) showTip();
            });
        }

        function startCollegeMatch() {
            console.log('College Match button clicked');
            els.modalTitle.textContent = 'College Matchmaker';
            els.modalContent.innerHTML = `
                <p class="mb-3">Select your preferred location to find colleges:</p>
                <select id="matchLocation" class="w-full p-2 rounded mb-3 text-xs sm:text-sm">
                    <option value="Bangalore">Bangalore</option>
                    <option value="Other">Other</option>
                </select>
            `;
            els.modalActions.innerHTML = `
                <button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Cancel</button>
                <button class="btn btn-pulse text-white" onclick="showMatchResults()">Get Matches</button>
            `;
            els.modal.classList.remove('hidden');
        }

        function showMatchResults() {
            console.log('Showing college match results');
            const location = document.getElementById('matchLocation').value;
            const matches = colleges.filter(c => c.location === location);
            els.modalContent.innerHTML = `
                <p class="mb-3">Top college matches:</p>
                ${matches.length ? `
                    <ul class="list-disc pl-5 text-xs sm:text-sm">
                        ${matches.map(c => `
                            <li>
                                ${c.name}
                                <ul class="list-circle pl-5">
                                    ${c.branches.filter(b => b.cutoff[els.inputs.category.value] > currentRank).map(b => `<li>${b.name}</li>`).join('')}
                                </ul>
                            </li>
                        `).join('')}
                    </ul>
                ` : '<p>No matches found. Try adjusting preferences.</p>'}
            `;
            els.modalActions.innerHTML = `<button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Close</button>`;
            els.modal.classList.remove('hidden');
        }

        function startBranchPredictor() {
            console.log('Branch Predictor button clicked');
            els.modalTitle.textContent = 'Branch Predictor';
            els.modalContent.innerHTML = `
                <p class="mb-3">Select preferences to find achievable branches:</p>
                <div class="mb-3">
                    <label class="block text-xs sm:text-sm font-medium mb-2">Preferred College</label>
                    <select id="branchCollege" class="w-full p-2 rounded text-xs sm:text-sm">
                        <option value="all">All Colleges</option>
                        ${colleges.map(c => `<option value="${c.name}">${c.name}</option>`).join('')}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block text-xs sm:text-sm font-medium mb-2">Location</label>
                    <select id="branchLocation" class="w-full p-2 rounded text-xs sm:text-sm">
                        <option value="all">All Locations</option>
                        <option value="Bangalore">Bangalore</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            `;
            els.modalActions.innerHTML = `
                <button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Cancel</button>
                <button class="btn btn-pulse text-white" onclick="showBranchResults()">Predict Branches</button>
            `;
            els.modal.classList.remove('hidden');
        }

        function showBranchResults() {
            console.log('Showing branch predictor results');
            const college = document.getElementById('branchCollege').value;
            const location = document.getElementById('branchLocation').value;
            const category = els.inputs.category.value;
            let filteredColleges = colleges;
            if (college !== 'all') filteredColleges = filteredColleges.filter(c => c.name === college);
            if (location !== 'all') filteredColleges = filteredColleges.filter(c => c.location === location);
            const branches = [];
            filteredColleges.forEach(c => {
                c.branches.forEach(b => {
                    const cutoff = b.cutoff[category];
                    const likelihood = currentRank < cutoff * 0.8 ? 'High' : currentRank < cutoff * 1.2 ? 'Medium' : 'Low';
                    branches.push({
                        college: c.name,
                        branch: b.name,
                        cutoff,
                        likelihood,
                        demand: b.demand,
                        placement: b.placement
                    });
                });
            });
            branches.sort((a, b) => a.likelihood === 'High' ? -1 : b.likelihood === 'High' ? 1 : a.cutoff - b.cutoff);
            els.modalContent.innerHTML = `
                <p class="mb-3">Achievable branches for rank ${currentRank.toLocaleString()} (${category}):</p>
                ${branches.length ? `
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        ${branches.map(b => `
                            <div class="bg-gray-900 p-3 rounded text-xs sm:text-sm">
                                <h3 class="text-base font-medium glow-text">${b.branch}</h3>
                                <p class="text-gray-300">College: ${b.college}</p>
                                <p class="text-gray-300">Cutoff: ${b.cutoff.toLocaleString()}</p>
                                <p class="text-gray-300">Likelihood: <span class="${b.likelihood === 'High' ? 'text-green-400' : b.likelihood === 'Medium' ? 'text-yellow-400' : 'text-red-400'}">${b.likelihood}</span></p>
                                <p class="text-gray-300">Demand: ${b.demand}</p>
                                <p class="text-gray-300">Placement: ${b.placement}</p>
                            </div>
                        `).join('')}
                    </div>
                ` : '<p>No branches found. Try adjusting preferences or improving your rank.</p>'}
            `;
            els.modalActions.innerHTML = `<button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Close</button>`;
            els.modal.classList.remove('hidden');
        }

        function generateStudyPlan() {
            console.log('Study Plan button clicked');
            const pucPercent = (parseFloat(els.inputs.pucTotal.value) || 0) / 300 * 100;
            const kcetPercent = (parseFloat(els.inputs.kcetTotal.value) || 0) / 180 * 100;
            const weakArea = pucPercent < kcetPercent ? 'PUC subjects' : 'KCET preparation';
            const plan = `
                <p class="mb-3">Personalized Study Plan:</p>
                <ul class="list-disc pl-5 text-xs sm:text-sm">
                    <li>Focus on ${weakArea}: Allocate 2 hours daily to revise weak topics.</li>
                    <li>Daily MCQs: Solve 15 questions per subject to build speed.</li>
                    <li>Mock Tests: Take one full-length test weekly to track progress.</li>
                    <li>Time Management: Practice solving questions within 1 minute each.</li>
                    <li>Revision: Spend 30 minutes daily on formulas and key concepts.</li>
                </ul>
            `;
            els.modalTitle.textContent = 'Your Study Plan';
            els.modalContent.innerHTML = plan;
            els.modalActions.innerHTML = `<button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Close</button>`;
            els.modal.classList.remove('hidden');
        }

        function showAnalytics() {
            console.log('Analytics button clicked');
            els.modalTitle.textContent = 'Rank Trends Analytics';
            els.modalContent.innerHTML = `
                <p class="mb-3">View your rank trends over time:</p>
                <canvas id="rankChart" class="w-full h-64"></canvas>
                <div class="mt-3">
                    <label class="block text-xs sm:text-sm font-medium mb-2">Filter by Category</label>
                    <select id="chartCategory" class="w-full p-2 rounded text-xs sm:text-sm">
                        <option value="all">All Categories</option>
                        <option value="GM">General Merit</option>
                        <option value="OBC">OBC</option>
                        <option value="SC">SC</option>
                        <option value="ST">ST</option>
                    </select>
                </div>
            `;
            els.modalActions.innerHTML = `
                <button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Close</button>
                <button class="btn btn-pulse text-white" onclick="clearPredictions()">Clear Data</button>
            `;
            els.modal.classList.remove('hidden');
            renderChart();
        }

        function renderChart() {
            const ctx = document.getElementById('rankChart').getContext('2d');
            const filterCategory = document.getElementById('chartCategory').value;
            const filteredPredictions = filterCategory === 'all' ? predictions : predictions.filter(p => p.category === filterCategory);
            const labels = filteredPredictions.map(p => new Date(p.timestamp).toLocaleDateString());
            const data = filteredPredictions.map(p => p.rank);
            const theme = document.documentElement.getAttribute('data-theme');
            const primaryColor = theme === 'purple' ? '#7b2cbf' : '#6495ed';
            try {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Predicted Rank',
                            data: data,
                            borderColor: primaryColor,
                            backgroundColor: `${primaryColor}33`,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: false, title: { display: true, text: 'Rank', color: '#e2e8f0' }, ticks: { color: '#e2e8f0' } },
                            x: { title: { display: true, text: 'Date', color: '#e2e8f0' }, ticks: { color: '#e2e8f0' } }
                        },
                        plugins: {
                            legend: { labels: { color: '#e2e8f0' } },
                            tooltip: { backgroundColor: '#1a1a3d', titleColor: '#e2e8f0', bodyColor: '#e2e8f0' }
                        }
                    }
                });
            } catch (err) {
                console.error('Chart rendering error:', err);
                els.modalContent.innerHTML += '<p class="text-red-300 mt-2">Failed to render chart. Please try again.</p>';
            }
            document.getElementById('chartCategory').addEventListener('change', () => {
                ctx.canvas.remove();
                els.modalContent.querySelector('#rankChart').outerHTML = '<canvas id="rankChart" class="w-full h-64"></canvas>';
                renderChart();
            });
        }

        function clearPredictions() {
            console.log('Clear predictions clicked');
            predictions = [];
            localStorage.setItem('kcetPredictions', JSON.stringify(predictions));
            els.modalContent.innerHTML = '<p class="text-gray-300">Prediction data cleared. Make new predictions to view trends.</p>';
            els.modalActions.innerHTML = `<button class="btn btn-pulse text-white" onclick="els.modal.classList.add('hidden')">Close</button>`;
        }

        function downloadPdf() {
            console.log('Download PDF button clicked');
            const element = document.createElement('div');
            element.style.padding = '1in';
            element.style.background = '#1a1a3d';
            element.style.color = '#e2e8f0';
            element.style.fontFamily = 'Inter, sans-serif';
            const timestamp = new Date().toLocaleString();
            const category = els.inputs.category.value;
            const resultContent = els.result.cloneNode(true);
            resultContent.querySelectorAll('.btn').forEach(btn => btn.remove());
            resultContent.querySelectorAll('.card').forEach(card => {
                card.style.background = '#1a1a3d';
                card.style.border = '1px solid #6495ed';
                card.style.boxShadow = 'none';
                card.style.backdropFilter = 'none';
                card.style.padding = '20px';
            });
            resultContent.querySelectorAll('.glow-text').forEach(text => {
                text.style.textShadow = 'none';
                text.style.color = '#fff';
            });
            resultContent.querySelectorAll('.progress-bar').forEach(bar => {
                bar.style.background = '#6495ed';
                bar.style.boxShadow = 'none';
            });
            element.innerHTML = `
                <h1 style="font-family: 'Space Grotesk', sans-serif; font-size: 24px; text-align: center; color: #fff;">
                    KCET 2025 Rank Prediction
                </h1>
                <p style="font-size: 12px; text-align: center; color: #e2e8f0; margin: 10px 0;">
                    Generated on ${timestamp} for ${category}
                </p>
                <div style="margin: 20px 0;">
                    ${resultContent.innerHTML}
                </div>
                <p style="font-size: 10px; text-align: center; color: #ffd700; position: fixed; bottom: 0.5in; width: 100%;">
                    Disclaimer: This is a sample prediction. Verify with official KEA sources.
                </p>
            `;
            document.body.appendChild(element);
            setTimeout(() => {
                const opt = {
                    margin: [0.5, 0.5, 0.5, 0.5],
                    filename: 'KCET_2025_Rank_Prediction.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 3, useCORS: true, logging: true },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };
                try {
                    html2pdf().set(opt).from(element).save().then(() => {
                        document.body.removeChild(element);
                        console.log('PDF generated successfully');
                    });
                } catch (err) {
                    console.error('PDF generation error:', err);
                    document.body.removeChild(element);
                    alert('Failed to generate PDF. Please try again.');
                }
            }, 100);
        }

        function setupTheme() {
            const savedTheme = localStorage.getItem('theme') || 'blue';
            document.documentElement.setAttribute('data-theme', savedTheme);
            els.themeToggle.textContent = savedTheme === 'blue' ? 'Purple Cosmos' : 'Blue Nebula';
            els.themeToggle.addEventListener('click', () => {
                console.log('Theme toggle clicked');
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'blue' ? 'purple' : 'blue';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                els.themeToggle.textContent = newTheme === 'blue' ? 'Purple Cosmos' : 'Blue Nebula';
            });
        }

        function setupButtons() {
            console.log('Setting up buttons...');
            if (!els.calculate) console.error('Calculate button not found in DOM');
            else els.calculate.addEventListener('click', () => {
                console.log('Calculate button click detected');
                calculateRank();
            });
            if (els.save) els.save.addEventListener('click', () => {
                console.log('Save button clicked');
                const data = {
                    pucTotal: els.inputs.pucTotal.value,
                    kcetTotal: els.inputs.kcetTotal.value,
                    category: els.inputs.category.value
                };
                localStorage.setItem('kcetInputs', JSON.stringify(data));
                alert('Inputs saved!');
            });
            if (els.collegeMatch) els.collegeMatch.addEventListener('click', startCollegeMatch);
            if (els.branchPredict) els.branchPredict.addEventListener('click', startBranchPredictor);
            if (els.studyPlan) els.studyPlan.addEventListener('click', generateStudyPlan);
            if (els.analytics) els.analytics.addEventListener('click', showAnalytics);
            if (els.reset) els.reset.addEventListener('click', () => {
                console.log('Reset button clicked');
                Object.values(els.inputs).forEach(input => input.value = '');
                Object.values(els.errors).forEach(error => error.classList.add('hidden'));
                updateTotals();
                updateLiveRank();
                els.result.classList.add('hidden');
                els.colleges.classList.add('hidden');
            });
            if (els.edit) els.edit.addEventListener('click', () => {
                console.log('Edit button clicked');
                els.result.classList.add('hidden');
                els.colleges.classList.add('hidden');
            });
            if (els.viewColleges) els.viewColleges.addEventListener('click', () => {
                console.log('View Colleges button clicked');
                els.collegeList.innerHTML = colleges.map(c => `
                    <div class="bg-gray-900 p-3 rounded text-xs sm:text-sm">
                        <h3 class="text-base font-medium glow-text">${c.name}</h3>
                        <p class="text-gray-300">Location: ${c.location}</p>
                        <ul class="list-disc pl-5 mt-2">
                            ${c.branches.map(b => `
                                <li>${b.name}: Cutoff (${els.inputs.category.value}) ${b.cutoff[els.inputs.category.value].toLocaleString()}</li>
                            `).join('')}
                        </ul>
                    </div>
                `).join('');
                els.result.classList.add('hidden');
                els.colleges.classList.remove('hidden');
            });
            if (els.downloadPdf) els.downloadPdf.addEventListener('click', downloadPdf);
            if (els.backToResult) els.backToResult.addEventListener('click', () => {
                console.log('Back to Result button clicked');
                els.colleges.classList.add('hidden');
                els.result.classList.remove('hidden');
            });
            if (els.closeModal) els.closeModal.addEventListener('click', () => {
                console.log('Close Modal button clicked');
                els.modal.classList.add('hidden');
            });
            if (els.trendCollege) els.trendCollege.addEventListener('change', updateTrendBranchOptions);
            if (els.trendBranch) els.trendBranch.addEventListener('change', updateCutoffTable);
        }

        init();
    </script>
</body>
</html>
